<div class="container margem">

  <div class="card rounded shadow-sm p-3">
    <!-- Em Aberto -->
    <tabset>
      <tab (selectTab)="page=1" heading="Em Aberto" *ngIf="func == 'getSchedulesByDoctorId'">
        <table class="table table-striped table-hover">
          <thead class="thead-dark">
            <tr>
              <th class="d-none d-md-table-cell">
              </th>
              <th>#</th>
              <th>Data</th>
              <th>Hora</th>
              <th class="d-none d-md-table-cell">Especialidade</th>
              <th class="d-none d-md-table-cell">Tipo</th>
              <th>Valor</th>
              <th class="d-none d-md-table-cell">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let schedule of openedSchedules.slice((page == 1 ? 0 : 12 * (page-1)), (12 * page))" style="cursor: pointer;">
              <td class="d-none d-md-table-cell"></td>
              <td>{{schedule.id}}</td>
              <td>{{schedule.dataConsulta.substring(0, 10)}}</td>
              <td>{{schedule.dataConsulta.substring(11, 16)}}</td>
              <td class="d-none d-md-table-cell">{{schedule.especialidade}}</td>
              <td class="d-none d-md-table-cell">{{schedule.tipo}}</td>
              <td>{{schedule.valor}}</td>
              <td class="d-none d-md-table-cell">{{schedule.status}}</td>
              <td>
                <button (click)="openModal(schedule, deleteModal)" type="button" class="btn btn-danger">
                  <i class="fa fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
          <tfoot *ngIf="openedSchedules.length == 0">
            <tr>
              <td colspan="8" class="text-center">
                <h4>Nenhum agendamento encontrado!</h4>
              </td>
            </tr>
          </tfoot>
        </table>
        <div class="d-flex justify-content-center">

          <pagination
            [boundaryLinks]="true"
        
            [totalItems]="openedSchedules.length"
            [itemsPerPage]="12"
            [(ngModel)]="page"
        
            pageBtnClass="btn"
            previousText="&lsaquo;"
            nextText="&rsaquo;"
            firstText="&laquo;"
            lastText="&raquo;">
          </pagination>
        </div>
      </tab>
      <!-- Agendados -->
      <tab (selectTab)="page=1" heading="Agendados" *ngIf="scheduledSchedules">
        <table class="table table-striped table-hover">
          <thead class="thead-dark">
            <tr>
              <th class="d-none d-md-table-cell">
              </th>
              <th>#</th>
              <th>Data</th>
              <th>Hora</th>
              <th class="d-none d-md-table-cell">Especialidade</th>
              <th class="d-none d-md-table-cell">Tipo</th>
              <th class="d-none d-md-table-cell">{{func == 'getSchedulesByDoctorId' ? 'Paciente' : 'Doutor'}}</th>
              <th>Valor</th>
              <th class="d-none d-md-table-cell">Status</th>
            </tr>
          </thead>
          <tbody  *ngIf="scheduledSchedules">
            <tr (click)="openModal(schedule, detailModal)" *ngFor="let schedule of scheduledSchedules.slice((page == 1 ? 0 : 12 * (page-1)), (12 * page))" style="cursor: pointer;">
              <td class="d-none d-md-table-cell"></td>
              <td>{{schedule.id}}</td>
              <td>{{schedule.dataConsulta.substring(0, 10)}}</td>
              <td>{{schedule.dataConsulta.substring(11, 16)}}</td>
              <td class="d-none d-md-table-cell">{{schedule.especialidade}}</td>
              <td class="d-none d-md-table-cell">{{schedule.tipo}}</td>
              <td class="d-none d-md-table-cell">{{func == 'getSchedulesByDoctorId' ? schedule.usuario.nome.split(' ')[0] + ' ' + schedule.usuario.nome.split(' ')[schedule.usuario.nome.split(' ').length-1] : schedule.medico.nome.split(' ')[0] + ' ' + schedule.medico.nome.split(' ')[schedule.medico.nome.split(' ').length-1]}}</td>
              <td>{{schedule.valor}}</td>
              <td class="d-none d-md-table-cell">{{schedule.status}}</td>
              <td>
                <button type="button" (click)="openModal(schedule, cancelModal);$event.stopPropagation();" class="btn btn-danger">
                  <i class="fa fa-cancel"></i>
                </button>
              </td>
            </tr>
          </tbody>
          <tfoot *ngIf="scheduledSchedules.length == 0">
            <tr>
              <td colspan="8" class="text-center">
                <h4>Nenhum agendamento encontrado!</h4>
              </td>
            </tr>
          </tfoot>
        </table>
        <div class="d-flex justify-content-center">

          <pagination
            [boundaryLinks]="true"
        
            [totalItems]="scheduledSchedules.length"
            [itemsPerPage]="12"
            [(ngModel)]="page"
        
            pageBtnClass="btn"
            previousText="&lsaquo;"
            nextText="&rsaquo;"
            firstText="&laquo;"
            lastText="&raquo;">
          </pagination>
        </div>
      </tab>
      <!-- Fechados -->
      <tab (selectTab)="page=1" heading="Fechados" *ngIf="closedSchedules.length > 0">
        <table class="table table-striped table-hover">
          <thead class="thead-dark">
            <tr>
              <th class="d-none d-md-table-cell">
              </th>
              <th>#</th>
              <th>Data</th>
              <th>Hora</th>
              <th class="d-none d-md-table-cell">Especialidade</th>
              <th class="d-none d-md-table-cell">Tipo</th>
              <th class="d-none d-md-table-cell">{{func == 'getSchedulesByDoctorId' ? 'Paciente' : 'Doutor'}}</th>
              <th>Valor</th>
              <th class="d-none d-md-table-cell">Status</th>
            </tr>
          </thead>
          <tbody  *ngIf="closedSchedules.length > 0">
            <tr *ngFor="let schedule of closedSchedules.slice((page == 1 ? 0 : 12 * (page-1)), (12 * page))" style="cursor: pointer;">
              <td class="d-none d-md-table-cell"></td>
              <td>{{schedule.id}}</td>
              <td>{{schedule.dataConsulta.substring(0, 10)}}</td>
              <td>{{schedule.dataConsulta.substring(11, 16)}}</td>
              <td class="d-none d-md-table-cell">{{schedule.especialidade}}</td>
              <td class="d-none d-md-table-cell">{{schedule.tipo}}</td>
              <td class="d-none d-md-table-cell">{{func == 'getSchedulesByDoctorId' ? schedule.usuario.nome.split(' ')[0] + ' ' + schedule.usuario.nome.split(' ')[schedule.usuario.nome.split(' ').length-1] : schedule.medico.nome.split(' ')[0] + ' ' + schedule.medico.nome.split(' ')[schedule.medico.nome.split(' ').length-1]}}</td>
              <td>{{schedule.valor}}</td>
              <td class="d-none d-md-table-cell">{{schedule.status}}</td>
            </tr>
          </tbody>
          <tfoot *ngIf="closedSchedules.length == 0">
            <tr>
              <td colspan="8" class="text-center">
                <h4>Nenhum agendamento encontrado!</h4>
              </td>
            </tr>
          </tfoot>
        </table>
        <div class="d-flex justify-content-center">

          <pagination
            [boundaryLinks]="true"
        
            [totalItems]="closedSchedules.length"
            [itemsPerPage]="12"
            [(ngModel)]="page"
        
            pageBtnClass="btn"
            previousText="&lsaquo;"
            nextText="&rsaquo;"
            firstText="&laquo;"
            lastText="&raquo;">
          </pagination>
        </div>
      </tab>
    </tabset>
    
    <!-- Filtro -->
    <!-- <div class="d-flex">
      <div class="flex-fill pr-3">
        <div class="input-group mb-2">
          <div class="input-group-prepend">
            <div class="input-group-text">Filtro: </div>
          </div>
          <input type="text" class="form-control" placeholder="Dia">
        </div>
      </div>
      <div>
        <a class="d-flex btn btn-outline-primary" routerLink="/eventos/detalhe">
          <i class="fa fa-plus-circle my-1"></i>
          <b class="ml-1 d-none d-sm-block">Novo</b>
        </a>
      </div>
    </div> -->
    <!-- <h3>Filtro: {{filtroLista}}</h3> -->
    

    <div class="d-flex justify-content-center">

    </div>

  </div>

  <ng-template #deleteModal>
    <div class="modal-header d-flex text-align-center justify-content-center">
      <h5 class="h5">Aviso</h5>
    </div>
    <div class="modal-body text-center">
      <p>Deseja excluir a agenda do dia {{selectedSchedule.dataConsulta.substring(0, 10)}} - {{selectedSchedule.dataConsulta.substring(11, 16)}}?</p>
      <button type="button" class="btn btn-default ms-1" (click)="confirm('deleteSchedule')" >Sim</button>
      <button type="button" class="btn btn-primary ms-1" (click)="decline()" >Não</button>
    </div>
  </ng-template>

  <ng-template #cancelModal>
    <div class="modal-header d-flex text-align-center justify-content-center">
      <h5 class="h5">Aviso</h5>
    </div>
    <div class="modal-body text-center">
      <p>Deseja Cancelar a agenda do dia {{selectedSchedule.dataConsulta.substring(0, 10)}} - {{selectedSchedule.dataConsulta.substring(11, 16)}}?</p>
      <button type="button" class="btn btn-default ms-1" (click)="confirm('cancelSchedule')" >Sim</button>
      <button type="button" class="btn btn-primary ms-1" (click)="decline()" >Não</button>
    </div>
  </ng-template>

  <ng-template #detailModal>
    <div class="modal-header d-flex text-align-center justify-content-center">
      <h5 class="h5">Detalhes</h5>
      <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
        <span aria-hidden="true" class="visually-hidden">&times;</span>
      </button>
    </div>
    <div class="modal-body text-center">
      <div class="row">
        <span class="col-3 h6">Data: {{selectedSchedule.dataConsulta.substring(0, 10)}}</span>
        <span class="col-2 h6">Hora: {{selectedSchedule.dataConsulta.substring(11, 16)}}</span>
        <span class="col-4 h6">Especialidade: {{selectedSchedule.especialidade}}</span>
        <span class="col-3 h6">Tipo: {{selectedSchedule.tipo}}</span>
      </div>
      <div class="row">
        <span class="col h6">Valor: {{selectedSchedule.valor}}</span>
        <span class="col h6">Forma de pagamento: {{selectedSchedule.pagamento}}</span>
        <span class="col h6">Status do pagamento: </span>
      </div>
      <div class="row">
        <span class="col h6">Nome do {{func == 'getSchedulesByDoctorId' ? 'Paciente' : 'Doutor'}}: {{func == 'getSchedulesByDoctorId' ? selectedSchedule.usuario.nome.split(' ')[0] + ' ' + selectedSchedule.usuario.nome.split(' ')[selectedSchedule.usuario.nome.split(' ').length-1] : selectedSchedule.medico.nome.split(' ')[0] + ' ' + selectedSchedule.medico.nome.split(' ')[selectedSchedule.medico.nome.split(' ').length-1]}}</span>
        <span class="col h6">Idade: {{getAge(selectedSchedule.usuario.nascimento)}}</span>

      </div>
    </div>
  </ng-template>
</div>